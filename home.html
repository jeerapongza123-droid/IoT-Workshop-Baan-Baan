<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>IoT SMART HOME DASHBOARD</title>

    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        .th-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .th-box {
            background: rgba(78, 115, 223, 0.08);
            border-radius: 14px;
            padding: 18px;
            text-align: center;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.05);
        }

        .th-box i {
            font-size: 28px;
            margin-bottom: 6px;
        }

        .th-box.temp i {
            color: var(--danger-color);
        }

        .th-box.humi i {
            color: var(--primary-color);
        }

        .th-label {
            font-size: 14px;
            color: var(--text-muted);
            margin: 6px 0;
        }

        .th-value {
            font-size: 28px;
            font-weight: bold;
            color: var(--text-color);
        }


        :root {
            --primary-color: #4e73df;
            --success-color: #1cc88a;
            --danger-color: #e74a3b;
            --bg-color: #f4f7fe;
            --card-bg: #ffffff;
            --text-main: #2d3436;
            --text-muted: #636e72;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            --radius-lg: 24px;
            --radius-md: 16px;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Prompt', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* Development Mode Badge */
        .dev-badge {
            background: rgba(231, 74, 59, 0.1);
            color: var(--danger-color);
            padding: 5px 15px;
            border-radius: 50px;
            font-size: 11px;
            font-weight: 700;
            margin-top: 15px;
            border: 1px solid rgba(231, 74, 59, 0.2);
            letter-spacing: 1px;
        }

        /* Status Header */
        .header-status {
            width: 90%;
            max-width: 500px;
            margin-top: 15px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .status-badge {
            background: var(--card-bg);
            padding: 15px;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow);
            text-align: center;
            font-size: 13px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        /* Nav Bar */
        nav.main-nav {
            display: flex;
            gap: 12px;
            margin: 20px 0;
            width: 90%;
            max-width: 500px;
        }

        .btn-nav {
            flex: 1;
            background: var(--card-bg);
            border: none;
            padding: 14px;
            border-radius: var(--radius-md);
            font-family: 'Prompt';
            font-weight: 500;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: 0.3s;
            color: var(--text-main);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-nav:active {
            transform: scale(0.95);
        }

        .btn-nav.active {
            background: var(--primary-color);
            color: white;
        }

        #app {
            width: 90%;
            max-width: 500px;
            padding-bottom: 40px;
        }

        /* Cards */
        .card {
            background: var(--card-bg);
            border-radius: var(--radius-lg);
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        .card-title {
            font-weight: 600;
            font-size: 17px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title i {
            color: var(--primary-color);
        }

        /* Buttons Style */
        .action-btn {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: var(--radius-md);
            font-family: 'Prompt';
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            transition: 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 12px;
            background: #f8f9fc;
            color: var(--text-main);
        }

        .action-btn:active {
            transform: scale(0.97);
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
            box-shadow: 0 8px 20px rgba(78, 115, 223, 0.2);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
            box-shadow: 0 8px 20px rgba(28, 200, 138, 0.2);
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
            box-shadow: 0 8px 20px rgba(231, 74, 59, 0.2);
        }

        .btn-outline-danger {
            background: transparent;
            border: 2px solid var(--danger-color);
            color: var(--danger-color);
        }

        /* Status Indicator Text */
        .status-text {
            font-size: 14px;
            font-weight: 600;
            text-align: center;
            padding: 12px;
            border-radius: var(--radius-md);
            background: #f8f9fc;
            margin: 5px 0 20px 0;
            border: 1px solid #edf2f7;
        }

        /* Days Grid */
        .days-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .day-box {
            background: #f8f9fc;
            padding: 10px 5px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid #eee;
        }

        .day-btn {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            border: none;
            background: #fff;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            font-weight: 700;
            font-size: 10px;
            cursor: pointer;
            margin-bottom: 8px;
        }

        .day-status {
            font-size: 11px;
            font-weight: 700;
        }

        /* Time Input */
        input[type="time"] {
            width: 100%;
            padding: 15px;
            border-radius: var(--radius-md);
            border: 2px solid #edf2f7;
            margin-bottom: 15px;
            font-family: 'Prompt';
            text-align: center;
            font-size: 26px;
            font-weight: 700;
            color: var(--primary-color);
            background: #f8f9fc;
        }

        .label-mini {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 8px;
            display: block;
            padding-left: 5px;
        }

        .control-wrapper {
            display: flex;
            align-items: center;
            gap: 300px;
            /* ระยะห่างปุ่มกับข้อความ */
        }

        .action-btn.tiny {
            padding: 36px;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: 1px solid var(--primary-color);
            background-color: white;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: 0.2s;
        }

        .action-btn.tiny:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .action-btn.tiny i {
            font-size: 26px;
        }

        .status-text1 {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 12px;
            border: 1px solid #f44336;
            background-color: #ffeaea;
            color: #f44336;
            font-weight: 600;
            font-size: 14px;
            white-space: nowrap;
            user-select: none;
        }
    </style>

    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>

    <script>
        /* ฟังก์ชันดึงเวลาปัจจุบันใส่ในช่อง Input */
        function setCurrentTime() {
            setTimeout(() => {
                const now = new Date();
                const timeStr = now.getHours().toString().padStart(2, '0') + ":" + now.getMinutes().toString().padStart(2, '0');
                if (document.getElementById('settime1')) document.getElementById('settime1').value = timeStr;
                if (document.getElementById('settime2')) document.getElementById('settime2').value = timeStr;
            }, 100);
        }

        /* === JAVA SCRIPT LOGIC (คงเดิม 100%) === */
        window.addEventListener('DOMContentLoaded', () => {
            const isLoggedIn = sessionStorage.getItem("isLoggedIn");
            if (!isLoggedIn || isLoggedIn !== "true") {
                window.location.href = "index.html";
                return;
            }
            connect();

        });

        function go(page) {
            const app = document.getElementById('app');
            localStorage.setItem('currentPage', page);
            if (page === 'home') {
                app.innerHTML = `
        <div class="card">
            <div class="card-title"><i class="fas fa-cog"></i> ฟังก์ชันการทำงาน</div>
            
            <button class="action-btn" onclick="go('setting1')">
                <div style="background:rgba(78, 115, 223, 0.1); width:45px; height:45px; border-radius:12px; display:flex; align-items:center; justify-content:center;">
                    <i class="fas fa-clock" style="color:var(--primary-color); font-size:20px;"></i>
                </div>
                <div style="text-align:left; flex-grow:1;">
                    <span style="display:block; font-size:15px;">ตั้งค่าโปรแกรม 1</span>
                    <small style="color:var(--text-muted); font-weight:400;">จัดการเวลาเปิด-ปิดอัตโนมัติ</small>
                </div>
                <i class="fas fa-chevron-right" style="font-size:12px; opacity:0.3;"></i>
            </button>

            <button class="action-btn" onclick="go('setting2')">
                <div style="background:rgba(78, 115, 223, 0.1); width:45px; height:45px; border-radius:12px; display:flex; align-items:center; justify-content:center;">
                    <i class="fas fa-clock" style="color:var(--primary-color); font-size:20px;"></i>
                </div>
                <div style="text-align:left; flex-grow:1;">
                    <span style="display:block; font-size:15px;">ตั้งค่าโปรแกรม 2</span>
                    <small style="color:var(--text-muted); font-weight:400;">จัดการเวลาเปิด-ปิดอัตโนมัติ</small>
                </div>
                <i class="fas fa-chevron-right" style="font-size:12px; opacity:0.3;"></i>
            </button>

            <button class="action-btn" onclick="go('setting3')">
                <div style="background:rgba(78, 115, 223, 0.1); width:45px; height:45px; border-radius:12px; display:flex; align-items:center; justify-content:center;">
                    <i class="fas fa-clock" style="color:var(--primary-color); font-size:20px;"></i>
                </div>
                <div style="text-align:left; flex-grow:1;">
                    <span style="display:block; font-size:15px;">ตั้งค่าโปรแกรม 3</span>
                    <small style="color:var(--text-muted); font-weight:400;">จัดการเวลาเปิด-ปิดอัตโนมัติ</small>
                </div>
                <i class="fas fa-chevron-right" style="font-size:12px; opacity:0.3;"></i>
            </button>
        </div>

        <div class="card">
            <div class="card-title"><i class="fas fa-thermometer-half"></i> ระบบตรวจวัดอุณหภูมิและความชื้น พร้อมควบคุมรีเลย์</div>
            <button class="action-btn" onclick="go('temp&humi')">
                <div style="background:rgba(78, 115, 223, 0.1); width:45px; height:45px; border-radius:12px; display:flex; align-items:center; justify-content:center;">
                    <i class="fas fa-thermometer-half" style="color:var(--primary-color); font-size:20px;"></i>
                </div>
                <div style="text-align:left; flex-grow:1;">
                    <span style="display:block; font-size:15px;">ตรวจสอบอุณหภูมิ ความชื้น และการทำงานของรีเลย์</span>
                    <small style="color:var(--text-muted); font-weight:400;">ตั้งค่าการแจ้งเตือน Temp&Humi พร้อมควบคุมรีเลย์</small>
                </div>
                <i class="fas fa-chevron-right" style="font-size:12px; opacity:0.3;"></i>
            </button>
        </div>

        <div class="card">
            <div class="card-title"><i class="fas fa-redo"></i> ตั้งค่าวันและเวลาในการทำซ้ำ</div>
            <button class="action-btn" onclick="go('Set_Repeat')">
                <div style="background:rgba(78, 115, 223, 0.1); width:45px; height:45px; border-radius:12px; display:flex; align-items:center; justify-content:center;">
                    <i class="fas fa-sync-alt" style="color:var(--primary-color); font-size:20px;"></i>
                </div>
                <div style="text-align:left; flex-grow:1;">
                    <span style="display:block; font-size:15px;">กำหนดวันเวลาการทำซ้ำ</span>
                    <small style="color:var(--text-muted); font-weight:400;">เลือกวันและเวลาที่ต้องการให้ระบบทำงานซ้ำ ตั้งแต่ 1 นาที ถึง 23 ชั่วโมง 59 นาที</small>
                </div>
                <i class="fas fa-chevron-right" style="font-size:12px; opacity:0.3;"></i>
            </button>
        </div>

        <div class="card">
            <div class="card-title"><i class="fas fa-cloud-upload-alt"></i> Version Update</div>
            <button class="action-btn" onclick="go('version')">
                <div style="background:rgba(78, 115, 223, 0.1); width:45px; height:45px; border-radius:12px; display:flex; align-items:center; justify-content:center;">
                    <i class="fas fa-cloud-upload-alt" style="color:var(--primary-color); font-size:20px;"></i>
                </div>
                <div style="text-align:left; flex-grow:1;">
                    <span style="display:block; font-size:15px;">ตรวจสอบ Version Update</span>
                    <small style="color:var(--text-muted); font-weight:400;">อัปเดตเฟิร์มแวร์ใหม่ล่าสุด</small>
                </div>
                <i class="fas fa-chevron-right" style="font-size:12px; opacity:0.3;"></i>
            </button>
        </div>
    `;
            } else if (page === 'setting1') {
                connect();
                app.innerHTML = `
                    <div class="card">
                        <div class="card-title"><i class="fas fa-sliders-h"></i> ควบคุมอุปกรณ์</div>
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin-bottom:20px;">
                            <button class="action-btn btn-primary" onclick="refresh()"><i class="fas fa-sync"></i> รีเฟรช</button>
                            <button class="action-btn btn-outline-danger" onclick="reset('esp32/Resetp1')"><i class="fas fa-power-off"></i> รีเซ็ต</button>
                        </div>
                        
                        <label class="label-mini">โหมดการทำงาน:</label>
                        <button class="action-btn" onclick="send_mqtt_interlock('/pro_Gram-1','1')">
                            <i class="fas fa-robot" style="font-size:20px; color:var(--primary-color)"></i>
                            <span>Auto Program 1</span>
                        </button>
                        <p id="setp1" class="status-text">กำลังโหลด...</p>

                        <button class="action-btn" onclick="send_mqtt_interlock('/Repeatp1','1')">
                            <i class="fas fa-robot" style="font-size:20px; color:var(--primary-color)"></i>
                            <span>Set Repeat </span>
                        </button>
                        <p id="/Repeatp1_Status" class="status-text">กำลังโหลด...</p>

                        <button class="action-btn" onclick="send_mqtt_interlock('/esp_c','ON')">
                            <i class="fas fa-hand-pointer" style="font-size:20px; color:var(--primary-color)"></i>
                            <span>Manual Control</span>
                        </button>
                        <p id="/Status" class="status-text">กำลังโหลด...</p>
                    </div>

                    <div class="card">
                        <div class="card-title" style="color:var(--success-color)"><i class="fas fa-plus-circle"></i> ตั้งเวลาเปิด (Timer ON)</div>
                        <div class="days-grid">
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Sun','7')">อา.</button><div id="/Sun" class="day-status">--</div></div>
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Mon','1')">จ.</button><div id="/Mon" class="day-status">--</div></div>
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Tue','2')">อ.</button><div id="/Tue" class="day-status">--</div></div>
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Wed','3')">พ.</button><div id="/Wed" class="day-status">--</div></div>
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Thu','4')">พฤ.</button><div id="/Thu" class="day-status">--</div></div>
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Fri','5')">ศ.</button><div id="/Fri" class="day-status">--</div></div>
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Sat','6')">ส.</button><div id="/Sat" class="day-status">--</div></div>
                        </div>
                        <input id="settime1" type="time">
                        <button class="action-btn btn-success" onclick="set_time('/relay2', document.getElementById('settime1').value)">
                            <i class="fas fa-save"></i> บันทึกเวลาเปิด
                        </button>
                        <p id="/setok" class="status-text">Waiting...</p>
                    </div>

                    <div class="card">
                        <div class="card-title" style="color:var(--danger-color)"><i class="fas fa-minus-circle"></i> ตั้งเวลาปิด (Timer OFF)</div>
                        <div class="days-grid">
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Sun_Set_off','7')">อา.</button><div id="/Sun_off" class="day-status">--</div></div>
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Mon_Set_off','1')">จ.</button><div id="/Mon_off" class="day-status">--</div></div>
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Tue_Set_off','2')">อ.</button><div id="/Tue_off" class="day-status">--</div></div>
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Wed_Set_off','3')">พ.</button><div id="/Wed_off" class="day-status">--</div></div>
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Thu_Set_off','4')">พฤ.</button><div id="/Thu_off" class="day-status">--</div></div>
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Fri_Set_off','5')">ศ.</button><div id="/Fri_off" class="day-status">--</div></div>
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Sat_Set_off','6')">ส.</button><div id="/Sat_off" class="day-status">--</div></div>
                        </div>
                        <input id="settime2" type="time">
                        <button class="action-btn btn-danger" onclick="set_time('/relay3', document.getElementById('settime2').value)">
                            <i class="fas fa-save"></i> บันทึกเวลาปิด
                        </button>
                        <p id="/setokk" class="status-text">Waiting...</p>
                    </div>
                `;
                setCurrentTime();
            } else if (page === 'setting2') {
                connect();
                app.innerHTML = `
                    <div class="card">
                        <div class="card-title"><i class="fas fa-sliders-h"></i> ควบคุมอุปกรณ์</div>
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin-bottom:20px;">
                            <button class="action-btn btn-primary" onclick="refresh_p2()"><i class="fas fa-sync"></i> รีเฟรช</button>
                            <button class="action-btn btn-outline-danger" onclick="reset_p2('esp32/Resetp2')"><i class="fas fa-power-off"></i> รีเซ็ต</button>
                        </div>
                        
                        <label class="label-mini">โหมดการทำงาน:</label>
                        <button class="action-btn" onclick="send_mqtt_interlock('/pro_Gram-2','1')">
                            <i class="fas fa-robot" style="font-size:20px; color:var(--primary-color)"></i>
                            <span>Auto Program 2</span>
                        </button>
                        <p id="setp2" class="status-text">กำลังโหลด...</p>

                        <button class="action-btn" onclick="send_mqtt_interlock('/Repeatp2','1')">
                            <i class="fas fa-robot" style="font-size:20px; color:var(--primary-color)"></i>
                            <span>Set Repeat </span>
                        </button>
                        <p id="/Repeatp2_Status" class="status-text">กำลังโหลด...</p>

                        <button class="action-btn" onclick="send_mqtt_interlock('/esp_c','ON')">
                            <i class="fas fa-hand-pointer" style="font-size:20px; color:var(--primary-color)"></i>
                            <span>Manual Control</span>
                        </button>
                        <p id="/Status" class="status-text">กำลังโหลด...</p>
                    </div>

                    <div class="card">
                        <div class="card-title" style="color:var(--success-color)"><i class="fas fa-plus-circle"></i> ตั้งเวลาเปิด (Timer ON)</div>
                        <div class="days-grid">
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Sun','7')">อา.</button><div id="/Sun_on_p2" class="day-status">--</div></div>
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Mon','1')">จ.</button><div id="/Mon_on_p2" class="day-status">--</div></div>
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Tue','2')">อ.</button><div id="/Tue_on_p2" class="day-status">--</div></div>
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Wed','3')">พ.</button><div id="/Wed_on_p2" class="day-status">--</div></div>
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Thu','4')">พฤ.</button><div id="/Thu_on_p2" class="day-status">--</div></div>
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Fri','5')">ศ.</button><div id="/Fri_on_p2" class="day-status">--</div></div>
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Sat','6')">ส.</button><div id="/Sat_on_p2" class="day-status">--</div></div>
                        </div>
                        <input id="settime1" type="time">
                        <button class="action-btn btn-success" onclick="set_time('/relay2', document.getElementById('settime1').value)">
                            <i class="fas fa-save"></i> บันทึกเวลาเปิด
                        </button>
                        <p id="/setok-time2" class="status-text">Waiting...</p>
                    </div>

                    <div class="card">
                        <div class="card-title" style="color:var(--danger-color)"><i class="fas fa-minus-circle"></i> ตั้งเวลาปิด (Timer OFF)</div>
                        <div class="days-grid">
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Sun_Set_off','7')">อา.</button><div id="/Sun_Status_on_p2" class="day-status">--</div></div>
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Mon_Set_off','1')">จ.</button><div id="/Mon_Status_on_p2" class="day-status">--</div></div>
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Tue_Set_off','2')">อ.</button><div id="/Tue_Status_on_p2" class="day-status">--</div></div>
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Wed_Set_off','3')">พ.</button><div id="/Wed_Status_on_p2" class="day-status">--</div></div>
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Thu_Set_off','4')">พฤ.</button><div id="/Thu_Status_on_p2" class="day-status">--</div></div>
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Fri_Set_off','5')">ศ.</button><div id="/Fri_Status_on_p2" class="day-status">--</div></div>
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Sat_Set_off','6')">ส.</button><div id="/Sat_Status_on_p2" class="day-status">--</div></div>
                        </div>
                        <input id="settime2" type="time">
                        <button class="action-btn btn-danger" onclick="set_time('/relay3', document.getElementById('settime2').value)">
                            <i class="fas fa-save"></i> บันทึกเวลาปิด
                        </button>
                        <p id="/setokk-time2" class="status-text">Waiting...</p>
                    </div>
                `;
                setCurrentTime();
            } else if (page === 'setting3') {
                connect();
                app.innerHTML = `
                    <div class="card">
                        <div class="card-title"><i class="fas fa-sliders-h"></i> ควบคุมอุปกรณ์</div>
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin-bottom:20px;">
                            <button class="action-btn btn-primary" onclick="refresh_p3()"><i class="fas fa-sync"></i> รีเฟรช</button>
                            <button class="action-btn btn-outline-danger" onclick="reset_p3('esp32/Resetp3')"><i class="fas fa-power-off"></i> รีเซ็ต</button>
                        </div>
                        
                        <label class="label-mini">โหมดการทำงาน:</label>
                        <button class="action-btn" onclick="send_mqtt_interlock('/pro_Gram-3','1')">
                            <i class="fas fa-robot" style="font-size:20px; color:var(--primary-color)"></i>
                            <span>Auto Program 3</span>
                        </button>
                        <p id="setp3" class="status-text">กำลังโหลด...</p>

                        <button class="action-btn" onclick="send_mqtt_interlock('/Repeatp3','1')">
                            <i class="fas fa-robot" style="font-size:20px; color:var(--primary-color)"></i>
                            <span>Set Repeat </span>
                        </button>
                        <p id="/Repeatp3_Status" class="status-text">กำลังโหลด...</p>

                        <button class="action-btn" onclick="send_mqtt_interlock('/esp_c','ON')">
                            <i class="fas fa-hand-pointer" style="font-size:20px; color:var(--primary-color)"></i>
                            <span>Manual Control</span>
                        </button>
                        <p id="/Status" class="status-text">กำลังโหลด...</p>
                    </div>

                    <div class="card">
                        <div class="card-title" style="color:var(--success-color)"><i class="fas fa-plus-circle"></i> ตั้งเวลาเปิด (Timer ON)</div>
                        <div class="days-grid">
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Sun','7')">อา.</button><div id="/Sun_on_p3" class="day-status">--</div></div>
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Mon','1')">จ.</button><div id="/Mon_on_p3" class="day-status">--</div></div>
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Tue','2')">อ.</button><div id="/Tue_on_p3" class="day-status">--</div></div>
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Wed','3')">พ.</button><div id="/Wed_on_p3" class="day-status">--</div></div>
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Thu','4')">พฤ.</button><div id="/Thu_on_p3" class="day-status">--</div></div>
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Fri','5')">ศ.</button><div id="/Fri_on_p3" class="day-status">--</div></div>
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Sat','6')">ส.</button><div id="/Sat_on_p3" class="day-status">--</div></div>
                        </div>
                        <input id="settime1" type="time">
                        <button class="action-btn btn-success" onclick="set_time('/relay2', document.getElementById('settime1').value)">
                            <i class="fas fa-save"></i> บันทึกเวลาเปิด
                        </button>
                        <p id="/setok-time3" class="status-text">Waiting...</p>
                    </div>

                    <div class="card">
                        <div class="card-title" style="color:var(--danger-color)"><i class="fas fa-minus-circle"></i> ตั้งเวลาปิด (Timer OFF)</div>
                        <div class="days-grid">
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Sun_Set_off','7')">อา.</button><div id="/Sun_Status_on_p3" class="day-status">--</div></div>
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Mon_Set_off','1')">จ.</button><div id="/Mon_Status_on_p3" class="day-status">--</div></div>
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Tue_Set_off','2')">อ.</button><div id="/Tue_Status_on_p3" class="day-status">--</div></div>
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Wed_Set_off','3')">พ.</button><div id="/Wed_Status_on_p3" class="day-status">--</div></div>
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Thu_Set_off','4')">พฤ.</button><div id="/Thu_Status_on_p3" class="day-status">--</div></div>
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Fri_Set_off','5')">ศ.</button><div id="/Fri_Status_on_p3" class="day-status">--</div></div>
                            <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Sat_Set_off','6')">ส.</button><div id="/Sat_Status_on_p3" class="day-status">--</div></div>
                        </div>
                        <input id="settime2" type="time">
                        <button class="action-btn btn-danger" onclick="set_time('/relay3', document.getElementById('settime2').value)">
                            <i class="fas fa-save"></i> บันทึกเวลาปิด
                        </button>
                        <p id="/setokk-time3" class="status-text">Waiting...</p>
                    </div>
                `;
                setCurrentTime();
            } else if (page === 'temp&humi') {
                connect();
                app.innerHTML = `
        <div class="card">
            <div class="card-title">
                <i class="fas fa-thermometer-half"></i> อุณหภูมิ & ความชื้น
            </div>

            <div class="th-grid">
                <div class="th-box temp">
                    <i class="fas fa-temperature-high"></i>
                    <p class="th-label">อุณหภูมิปัจจุบัน</p>
                    <p id="tempjee" class="th-value">-- °C</p>
                </div>

                <div class="th-box humi">
                    <i class="fas fa-tint"></i>
                    <p class="th-label">ความชื้นปัจจุบัน</p>
                    <p id="humijee" class="th-value">-- %</p>
                </div>
            </div>

           
        </div>

        <div class="card">
            <div class="card-title" style="color:var(--primary-color);">
                <i class="fas fa-sliders-h"></i> ควบคุมและตั้งค่า
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px;">
                <button class="action-btn btn-primary" onclick="reset_temp_Humi('/Reset_T_H')">
                    <i class="fas fa-sync"></i> รีเซ็ต Temp & Humi
                </button>
                <button class="action-btn btn-outline-danger" onclick="send_mqtt_interlock('/esp_c','ON')">
                    <i class="fas fa-hand-pointer"></i> Manual Control
                </button>
            </div>

            <p id="/Status" class="status-text" style="margin-bottom:24px;">กำลังโหลด...</p>

            <!-- ตั้งค่าต่าง ๆ แบบเป็นระเบียบ -->
            <div style="display: flex; flex-direction: column; gap: 16px;">
                <button class="action-btn" onclick="send_mqtt_interlock('set_teMP','1')">
                    <i class="fas fa-thermometer-full" style="color:var(--primary-color);"></i>
                    <span>เปิด/ปิด การควบคุม Temp</span>
                </button>
                <p id="/Status_set_teMp" class="status-text">----------</p>

                <button class="action-btn" onclick="send_mqtt_interlock('set_HuMi','1')">
                    <i class="fas fa-tint" style="color:var(--primary-color);"></i>
                    <span>เปิด/ปิด การควบคุม Humi</span>
                </button>
                <p id="/Status_set_HuMi" class="status-text">----------</p>

                <button class="action-btn btn-danger" onclick="send_mqtt_interlock('set_teMP_Low','1')">
                    <i class="fas fa-temperature-low"></i>
                    <span>ตั้งค่า Temp Low Limit</span>
                </button>
                <p id="/Status_set_teMp_Low" class="status-text">----------</p>

                <button class="action-btn btn-danger" onclick="send_mqtt_interlock('set_teMP_High','1')">
                    <i class="fas fa-temperature-high"></i>
                    <span>ตั้งค่า Temp High Limit</span>
                </button>
                <p id="/Status_set_teMp_High" class="status-text">----------</p>

                <button class="action-btn btn-primary" onclick="send_mqtt_interlock('set_HuMi_Low','1')">
                    <i class="fas fa-tint-slash"></i>
                    <span>ตั้งค่า Humi Low Limit</span>
                </button>
                <p id="/Status_set_HuMi_Low" class="status-text">----------</p>

                <button class="action-btn btn-primary" onclick="send_mqtt_interlock('set_HuMi_High','1')">
                    <i class="fas fa-tint"></i>
                    <span>ตั้งค่า Humi High Limit</span>
                </button>
                <p id="/Status_set_HuMi_High" class="status-text">----------</p>
            </div>
        </div>

         <button class="action-btn" onclick="go('Set_value')">
                            <div style="background:rgba(78, 115, 223, 0.1); width:45px; height:45px; border-radius:12px; display:flex; align-items:center; justify-content:center;">
                                <i class="fas fa-clock" style="color:var(--primary-color); font-size:20px;"></i>
                            </div>
                            <div style="text-align:left; flex-grow:1;">
                                <span style="display:block; font-size:15px;">ตั้งค่าการเปิด-ปิดรีเลย์ตามอุณหภูมิ&ความชื้น </span>
                                <small style="color:var(--text-muted); font-weight:400;">จัดการรีเลย์เปิด-ปิดอัตโนมัติ</small>
                            </div>
                            <i class="fas fa-chevron-right" style="font-size:12px; opacity:0.3;"></i>
                        </button>
    `;
            } else if (page === 'Set_value') {
                connect();
                app.innerHTML = `
                   <div class="card">
                        <div class="card-title"><i class="fas fa-th-large"></i> ระบบตรวจวัดอุณหภูมิและความชื้น พร้อมควบคุมรีเลย์</div>
                        <button class="action-btn" onclick="go('temp&humi')">
                            <div style="background:rgba(78, 115, 223, 0.1); width:45px; height:45px; border-radius:12px; display:flex; align-items:center; justify-content:center;">
                                <i class="fas fa-clock" style="color:var(--primary-color); font-size:20px;"></i>
                            </div>
                            <div style="text-align:left; flex-grow:1;">
                                <span style="display:block; font-size:15px;">ตรวจสอบอุณหภูมิ ความชื้น และการทำงานของรีเลย์</span>
                                <small style="color:var(--text-muted); font-weight:400;">ตั้งค่าการแจ้งเตือน Temp&Humi พร้อมควบคุมรีเลย์</small>
                            </div>
                            <i class="fas fa-chevron-right" style="font-size:12px; opacity:0.3;"></i>
                        </button>

                     
                    </div>


        <div class="card">
            <div class="card-title">
                <i class="fas fa-cog"></i> ตั้งค่าช่วงอุณหภูมิ & ความชื้น
            </div>

            <!-- แสดงค่าที่ตั้งไว้ปัจจุบัน -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px;">
                <div class="th-box temp">
                    <i class="fas fa-temperature-high"></i>
                    <p class="th-label">Temp High Limit</p>
                    <p id="/set_temp_high_value" class="th-value">-- °C</p>
                </div>
                <div class="th-box temp">
                    <i class="fas fa-temperature-low"></i>
                    <p class="th-label">Temp Low Limit</p>
                    <p id="/set_temp_low_value" class="th-value">-- °C</p>
                </div>
                <div class="th-box humi">
                    <i class="fas fa-tint"></i>
                    <p class="th-label">Humi High Limit</p>
                    <p id="/set_humi_high_value" class="th-value">-- %</p>
                </div>
                <div class="th-box humi">
                    <i class="fas fa-tint-slash"></i>
                    <p class="th-label">Humi Low Limit</p>
                    <p id="/set_humi_low_value" class="th-value">-- %</p>
                </div>
            </div>

           
        </div>

        <div class="card">
            <div class="card-title" style="color: var(--primary-color);">
                <i class="fas fa-edit"></i> ปรับตั้งค่าใหม่
            </div>

            <div style="display: flex; flex-direction: column; gap: 20px;">
                <!-- Temp High -->
                <div>
                    <label class="label-mini">อุณหภูมิสูงสุด (High Limit)</label>
                    <div style="display: flex; gap: 12px; align-items: center;">
                        <input type="number" id="high_temp" placeholder="เช่น 35.43 , 23" style="
                            flex: 1;
                            padding: 14px;
                            font-size: 18px;
                            border: 2px solid #edf2f7;
                            border-radius: var(--radius-md);
                            text-align: center;
                            background: #f8f9fc;
                        ">
                        <button class="action-btn btn-danger" onclick="send_mqtt('/set_temp_high', document.getElementById('high_temp').value)">
                            <i class="fas fa-save"></i> บันทึก
                        </button>
                    </div>
                </div>

                <!-- Temp Low -->
                <div>
                    <label class="label-mini">อุณหภูมิต่ำสุด (Low Limit)</label>
                    <div style="display: flex; gap: 12px; align-items: center;">
                        <input type="number" id="low_temp" placeholder="เช่น 18.4, 12 " style="
                            flex: 1;
                            padding: 14px;
                            font-size: 18px;
                            border: 2px solid #edf2f7;
                            border-radius: var(--radius-md);
                            text-align: center;
                            background: #f8f9fc;
                        ">
                        <button class="action-btn btn-danger" onclick="send_mqtt('/set_temp_low', document.getElementById('low_temp').value)">
                            <i class="fas fa-save"></i> บันทึก
                        </button>
                    </div>
                </div>

                <!-- Humi High -->
                <div>
                    <label class="label-mini">ความชื้นสูงสุด (High Limit)</label>
                    <div style="display: flex; gap: 12px; align-items: center;">
                        <input type="number" id="high_humi" placeholder="เช่น 85.2,92" style="
                            flex: 1;
                            padding: 14px;
                            font-size: 18px;
                            border: 2px solid #edf2f7;
                            border-radius: var(--radius-md);
                            text-align: center;
                            background: #f8f9fc;
                        ">
                        <button class="action-btn btn-primary" onclick="send_mqtt('/set_humi_high', document.getElementById('high_humi').value)">
                            <i class="fas fa-save"></i> บันทึก
                        </button>
                    </div>
                </div>

                <!-- Humi Low -->
                <div>
                    <label class="label-mini">ความชื้นต่ำสุด (Low Limit)</label>
                    <div style="display: flex; gap: 12px; align-items: center;">
                        <input type="number" id="low_humi" placeholder="เช่น 40.1 ,42" style="
                            flex: 1;
                            padding: 14px;
                            font-size: 18px;
                            border: 2px solid #edf2f7;
                            border-radius: var(--radius-md);
                            text-align: center;
                            background: #f8f9fc;
                        ">
                        <button class="action-btn btn-primary" onclick="send_mqtt('/set_humi_low', document.getElementById('low_humi').value)">
                            <i class="fas fa-save"></i> บันทึก
                        </button>
                    </div>
                </div>
            </div>

            <div style="margin-top: 24px; text-align: center; color: var(--text-muted); font-size: 13px;">
                กรุณาใส่ค่าตัวเลขเท่านั้น (เช่น 30.1, 30 ,28 ) และกดบันทึก
            </div>
        </div>
    `;
            } else if (page === 'Set_Repeat') {
                connect();
                app.innerHTML = `
        <div class="card" style="background: linear-gradient(135deg, #ffffff 0%, #f8fbff 100%); border: 1px solid rgba(78,115,223,0.15);">
            <div class="card-title" style="font-size:18px; padding-bottom:12px; border-bottom:1px solid #edf2f7;">
                <i class="fas fa-redo-alt" style="color:var(--primary-color); margin-right:10px;"></i>
                ตั้งค่าการทำงานซ้ำ (Repeat Timer)
            </div>

            

         <!-- ส่วนควบคุมหลัก + รีเซ็ต -->
<div style="display: flex; flex-wrap: wrap; gap: 12px; margin: 20px 0;">
    <button class="action-btn btn-primary" onclick="reset_Repeat('esp32/Reset_Repeat')">
        <i class="fas fa-sync-alt"></i> รีเซ็ต Repeat
    </button>

    <button class="action-btn" onclick="send_mqtt_interlock('/Repeat_minute','1')">
        <i class="fas fa-clock"></i> Repeat ทุกนาที
        <span id="repeat-minute-label" style="margin-left:8px; font-size:0.9em; opacity:0.8;"></span>
    </button>

    <button class="action-btn" onclick="send_mqtt_interlock('/Repeat_minute_hour','1')">
        <i class="fas fa-hourglass-half"></i> Repeat ชม.+นาที
        <span id="repeat-hour-label" style="margin-left:8px; font-size:0.9em; opacity:0.8;"></span>
    </button>
</div>

<p id="/Status_RP_minute" class="status-text" style="margin:4px 0;"></p>
<p id="/Status_RP_minute_hour" class="status-text" style="margin:4px 0;"></p>



            <!-- วันทำซ้ำ -->
            <div class="card" style="margin-bottom:24px; box-shadow: 0 4px 15px rgba(0,0,0,0.06);">
                <div class="card-title" style="color:var(--success-color); font-size:16px;">
                    <i class="fas fa-calendar-check"></i> วันที่จะให้ระบบทำงานซ้ำ
                </div>
                <div class="days-grid" style="padding: 8px; background: rgba(28,200,138,0.03); border-radius: 12px;">
                    <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Sun','7')">อา.</button><div id="/Sun_Repeat" class="day-status">--</div></div>
                    <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Mon','1')">จ.</button><div id="/Mon_Repeat" class="day-status">--</div></div>
                    <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Tue','2')">อ.</button><div id="/Tue_Repeat" class="day-status">--</div></div>
                    <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Wed','3')">พ.</button><div id="/Wed_Repeat" class="day-status">--</div></div>
                    <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Thu','4')">พฤ.</button><div id="/Thu_Repeat" class="day-status">--</div></div>
                    <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Fri','5')">ศ.</button><div id="/Fri_Repeat" class="day-status">--</div></div>
                    <div class="day-box"><button class="day-btn" onclick="send_mqtt_interlock('/Sat','6')">ส.</button><div id="/Sat_Repeat" class="day-status">--</div></div>
                </div>
            </div>

            <!-- ตั้งค่าเวลาเริ่มต้น + ช่วงซ้ำ -->
            <div class="card" style="background: rgba(78,115,223,0.03); border: 1px solid rgba(78,115,223,0.15);">
                <div class="card-title" style="color:var(--primary-color); font-size:16px;">
                    <i class="fas fa-stopwatch"></i> กำหนดเวลาเริ่มต้นและช่วงการซ้ำ
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-top: 16px;">
                    <!-- เริ่มต้น ชั่วโมง -->
                    <div class="control-group" style="background:white; padding:16px; border-radius:12px; box-shadow:0 3px 10px rgba(0,0,0,0.05);">
                        <label class="label-mini" style="display:block; margin-bottom:8px;">เริ่มต้นที่ชั่วโมง</label>
                        <input type="number" id="Start_hour" min="0" max="23" placeholder="0–23" 
                               style="width:100%; padding:14px; font-size:20px; text-align:center; border:2px solid #e2e8f0; border-radius:10px; margin-bottom:10px; background:#fdfdff;">
                        <button class="action-btn btn-success" style="width:100%;" 
                                onclick="send_mqtt('/Set_H',document.getElementById('Start_hour').value)">
                            <i class="fas fa-save"></i> บันทึกชั่วโมงเริ่ม
                        </button>
                    </div>

                    <!-- เริ่มต้น นาที -->
                    <div class="control-group" style="background:white; padding:16px; border-radius:12px; box-shadow:0 3px 10px rgba(0,0,0,0.05);">
                        <label class="label-mini" style="display:block; margin-bottom:8px;">เริ่มต้นที่นาที</label>
                        <input type="number" id="Start_minute" min="0" max="59" placeholder="0–59" 
                               style="width:100%; padding:14px; font-size:20px; text-align:center; border:2px solid #e2e8f0; border-radius:10px; margin-bottom:10px; background:#fdfdff;">
                        <button class="action-btn btn-success" style="width:100%;" 
                                onclick="send_mqtt('/Set_T',document.getElementById('Start_minute').value)">
                            <i class="fas fa-save"></i> บันทึกนาทีเริ่ม
                        </button>
                    </div>

                    <!-- ซ้ำทุก ชั่วโมง -->
                    <div class="control-group" style="background:white; padding:16px; border-radius:12px; box-shadow:0 3px 10px rgba(0,0,0,0.05);">
                        <label class="label-mini" style="display:block; margin-bottom:8px;">ทำซ้ำทุก</label>
                        <input type="number" id="Repeat_hour" min="0" max="23" placeholder="ชั่วโมง (0=ไม่ซ้ำ)" 
                               style="width:100%; padding:14px; font-size:20px; text-align:center; border:2px solid #e2e8f0; border-radius:10px; margin-bottom:10px; background:#fdfdff;">
                        <button class="action-btn btn-primary" style="width:100%;" 
                                onclick="send_mqtt('/Repeat_hour_input',document.getElementById('Repeat_hour').value)">
                            <i class="fas fa-save"></i> บันทึกช่วงชั่วโมง
                        </button>
                    </div>

                    <!-- ซ้ำทุก นาที -->
                    <div class="control-group" style="background:white; padding:16px; border-radius:12px; box-shadow:0 3px 10px rgba(0,0,0,0.05);">
                        <label class="label-mini" style="display:block; margin-bottom:8px;">ทำซ้ำทุก</label>
                        <input type="number" id="Repeat_minute" min="1" max="59" placeholder="นาที (1-59)" 
                               style="width:100%; padding:14px; font-size:20px; text-align:center; border:2px solid #e2e8f0; border-radius:10px; margin-bottom:10px; background:#fdfdff;">
                        <button class="action-btn btn-primary" style="width:100%;" 
                                onclick="send_mqtt('/Repeat_minute_input',document.getElementById('Repeat_minute').value)">
                            <i class="fas fa-save"></i> บันทึกช่วงนาที
                        </button>
                    </div>
                </div>
            </div>

            <!-- สถานะสรุป -->
            <div class="card" style="margin-top:24px; background: rgba(28,200,138,0.04); border:1px solid rgba(28,200,138,0.2);">
                <div class="card-title" style="color:var(--success-color); font-size:16px;">
                    <i class="fas fa-info-circle"></i> สถานะการตั้งค่าปัจจุบัน
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px; padding: 12px;">
                    <div class="status-text" style="background:white; border:1px solid #e2e8f0;">
                        เริ่มต้น <strong id="/set_Start_hour_value" style="color:var(--primary-color);">--</strong> : 
                        <strong id="/set_Start_minute_value" style="color:var(--primary-color);">--</strong>
                    </div>
                    <div class="status-text" style="background:white; border:1px solid #e2e8f0;">
                        ซ้ำทุก <strong id="/set_Repeat_hour_value" style="color:var(--success-color);">--</strong> ชม.  
                        <strong id="/set_Repeat_minute_value" style="color:var(--success-color);">--</strong> น.
                    </div>
                    <div class="status-text" style="background:white; border:1px solid #e2e8f0; grid-column: span 2;">
                        ครั้งถัดไป <strong id="/Next_hour" style="color:#e67e22;">--</strong> : 
                        <strong id="/Next_minute" style="color:#e67e22;">--</strong>
                    </div>
                    <div class="status-text" style="background:white; border:1px solid #e2e8f0; grid-column: span 2; text-align:center;">
                        LED Hour: <strong id="/LED_RP_hour">--</strong>  
                          |  Minute: <strong id="/LED_RP_minute">--</strong>
                    </div>
                </div>
            </div>
        </div>
    `;
            } else if (page === 'version') {
                connect();
                app.innerHTML = `
        <div class="card">
            <div class="card-title">
                <i class="fas fa-cloud-upload-alt" style="color: var(--primary-color);"></i>
                อัปเดตเฟิร์มแวร์ (OTA)
            </div>

            <div style="margin: 20px 0; text-align: center;">
                <p class="th-label" style="margin-bottom: 12px;">
                    กดปุ่มด้านล่างเพื่อเริ่มอัปเดตเฟิร์มแวร์ผ่าน OTA
                </p>
                
                <button class="action-btn btn-primary" 
                        onclick="send_mqtt('/ESP_upload_OTA_', 'Update_OTA')">
                    <i class="fas fa-cloud-upload-alt"></i>
                    Update Version
                </button>
            </div>

            <!-- สถานะการ เวอร์ชันปัจจุบัน - ปรับให้เข้ากับเพื่อน ๆ -->
            <div style="margin-top: 28px; padding: 16px; background: #f8f9fc; border-radius: 12px; border: 1px solid #edf2f7; text-align: center;">
                <p class="th-label" style="margin-bottom: 8px; font-size: 14px;">
                    <i class="fas fa-info-circle" style="color: var(--primary-color); margin-right: 6px;"></i>
                     เวอร์ชันปัจจุบัน
                </p>
                <p id="/status_version" class="status-text" style="font-size: 16px; font-weight: 600; margin: 0; padding: 12px;">
                    กำลังโหลด...
                </p>
            </div>

            <!--  สถานะการอัปเดต (ถ้ามี topic แยก) -->
            <div style="margin-top: 20px; padding: 12px; background: rgba(28,200,138,0.05); border-radius: 10px; text-align: center;">
                <p class="th-label" style="margin: 0 0 6px 0; font-size: 13px;">
                    <i class="fas fa-code-branch" style="color: var(--success-color); margin-right: 6px;"></i>
                     สถานะการอัปเดต
                </p>
                <p id="/status_V" class="th-value" style="font-size: 20px; margin: 0; color: var(--text-main);">
                    -----------
                </p>
            </div>

            <div style="margin-top: 24px; text-align: center; color: var(--text-muted); font-size: 13px; line-height: 1.5;">
                หมายเหตุ: ระหว่างอัปเดต ระบบอาจหยุดตอบสนองชั่วคราว<br>
                กรุณาอย่าปิดหน้าเว็บหรือถอดปลั๊กอุปกรณ์
            </div>
        </div>

        <!-- ปุ่มกลับ -->
        <button class="action-btn" onclick="go('home')" style="margin-top: 24px;">
            <i class="fas fa-arrow-left"></i> กลับไปหน้าหลัก
        </button>
    `;
            }

        }

        function updateStatusColor(id, text) {
            const el = document.getElementById(id);
            if (!el) return;
            el.innerText = text;

            // Logic เปลี่ยนสี เขียว-แดง
            if (text.includes("ON") || text.includes("Online") || text.includes("Set ON") || text.includes("OPEN")) {
                el.style.color = "var(--success-color)";
                el.style.borderColor = "var(--success-color)";
                el.style.background = "rgba(28, 200, 138, 0.05)";
            } else if (text.includes("Off") || text.includes("OFF") || text.includes("Offline") || text.includes("CLOSE")) {
                el.style.color = "var(--danger-color)";
                el.style.borderColor = "var(--danger-color)";
                el.style.background = "rgba(231, 74, 59, 0.05)";
            } else {
                el.style.color = "var(--text-muted)";
                el.style.background = "#f8f9fc";
            }



        }

        /* MQTT LOGIC */
        function refresh() {
            setTimeout(() => { send_mqtt('/Repro1', '1'); send_mqtt('/Repro1', '0'); }, 100);
        }
        function refresh_p2() {
            setTimeout(() => { send_mqtt('/Repro2', '1'); send_mqtt('/Repro2', '0'); }, 100);
        }
        function refresh_p3() {
            setTimeout(() => { send_mqtt('/Repro3', '1'); send_mqtt('/Repro3', '0'); }, 100);
        }
        function reset(data_Reset) { if (data_Reset === 'esp32/Resetp1') { setTimeout(() => { send_mqtt('esp32/Resetp1', '1'); send_mqtt('esp32/Resetp1', '0'); }, 100); } }
        function reset_p2(data_Reset) { if (data_Reset === 'esp32/Resetp2') { setTimeout(() => { send_mqtt('esp32/Resetp2', '1'); send_mqtt('esp32/Resetp2', '0'); }, 100); } }
        function reset_p3(data_Reset) { if (data_Reset === 'esp32/Resetp3') { setTimeout(() => { send_mqtt('esp32/Resetp3', '1'); send_mqtt('esp32/Resetp3', '0'); }, 100); } }

        function reset_temp_Humi(data_Reset) { if (data_Reset === '/Reset_T_H') { setTimeout(() => { send_mqtt('/Reset_T_H', '1'); send_mqtt('/Reset_T_H', '0'); }, 100); } }
        function reset_Repeat(data_Reset) { if (data_Reset === 'esp32/Reset_Repeat') { setTimeout(() => { send_mqtt('esp32/Reset_Repeat', '1'); send_mqtt('esp32/Reset_Repeat', '0'); }, 100); } }


        function set_time(topic, payl) { if (!payl) return; client.publish(topic, payl); }
        function logout() { sessionStorage.clear(); localStorage.clear(); window.location.href = "index.html"; }

        window.addEventListener('DOMContentLoaded', () => {
            const page = localStorage.getItem('currentPage') || 'home';
            go(page);
        });

        var client;
        function connect() {
            const brokerUrl = 'wss://broker.hivemq.com:8884/mqtt';
            const options = { keepalive: 60, clientId: 'web_' + Math.random().toString(16).substr(2, 8) };
            client = mqtt.connect(brokerUrl, options);
            client.on('connect', () => {
                const st = document.getElementById('status');
                if (st) {
                    st.innerHTML = '<i class="fas fa-link" style="color:var(--success-color); font-size:14px; margin-right:8px;"></i> MQTT: Connected';
                    st.style.color = "var(--success-color)";
                }


                client.subscribe('/node'); client.subscribe('set-p1-ok'); client.subscribe('set-p2-ok'); client.subscribe('set-p3-ok');
                client.subscribe('/Status'); client.subscribe('/Sun_on');
                client.subscribe("/Mon_on"); client.subscribe("/Tue_on");
                client.subscribe("/Wed_on"); client.subscribe("/Thu_on");
                client.subscribe("/Fri_on"); client.subscribe("/Sat_on");
                client.subscribe('/Sun_Status_on'); client.subscribe('/Mon_Status_on');
                client.subscribe('/Tue_Status_on'); client.subscribe('/Wed_Status_on');
                client.subscribe('/Thu_Status_on'); client.subscribe('/Fri_Status_on');
                client.subscribe('/Sat_Status_on');

                client.subscribe('/Sun_on_p2');
                client.subscribe('/Mon_on_p2');
                client.subscribe('/Tue_on_p2');
                client.subscribe('/Wed_on_p2');
                client.subscribe('/Thu_on_p2');
                client.subscribe('/Fri_on_p2');
                client.subscribe('/Sat_on_p2');


                client.subscribe('/Sun_Status_on_p2');
                client.subscribe('/Mon_Status_on_p2');
                client.subscribe('/Tue_Status_on_p2');
                client.subscribe('/Wed_Status_on_p2');
                client.subscribe('/Thu_Status_on_p2');
                client.subscribe('/Fri_Status_on_p2');
                client.subscribe('/Sat_Status_on_p2');


                // ON status
                client.subscribe('/Sun_on_p3');
                client.subscribe('/Mon_on_p3');
                client.subscribe('/Tue_on_p3');
                client.subscribe('/Wed_on_p3');
                client.subscribe('/Thu_on_p3');
                client.subscribe('/Fri_on_p3');
                client.subscribe('/Sat_on_p3');

                // OFF status
                client.subscribe('/Sun_Status_on_p3');
                client.subscribe('/Mon_Status_on_p3');
                client.subscribe('/Tue_Status_on_p3');
                client.subscribe('/Wed_Status_on_p3');
                client.subscribe('/Thu_Status_on_p3');
                client.subscribe('/Fri_Status_on_p3');
                client.subscribe('/Sat_Status_on_p3');





                client.subscribe('/setok'); client.subscribe('/setokk'); client.subscribe('/setok-time2'); client.subscribe('/setokk-time2'); client.subscribe('/setok-time3'); client.subscribe('/setokk-time3');
                client.subscribe('/Repeatp1_Status'); client.subscribe('/Repeatp2_Status'); client.subscribe('/Repeatp3_Status');


                client.subscribe('tempjee'); client.subscribe('humijee');

                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                client.subscribe('/set_temp_high_value'); client.subscribe('/set_temp_low_value');
                client.subscribe('/set_humi_high_value'); client.subscribe('/set_humi_low_value');
                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                client.subscribe('/Status_set_teMp'); client.subscribe('/Status_set_HuMi');
                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                client.subscribe('/Status_set_teMp_Low'); client.subscribe('/Status_set_HuMi_Low');
                client.subscribe('/Status_set_teMp_High'); client.subscribe('/Status_set_HuMi_High');

                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                client.subscribe('/Status_RP_minute'); client.subscribe('/Status_RP_minute_hour')
                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                client.subscribe('/LED_RP_hour'); client.subscribe('/LED_RP_minute');
                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                // ON status Repeat
                client.subscribe('/Mon_Repeat');
                client.subscribe('/Tue_Repeat');
                client.subscribe('/Wed_Repeat');
                client.subscribe('/Thu_Repeat');
                client.subscribe('/Fri_Repeat');
                client.subscribe('/Sat_Repeat');
                client.subscribe('/Sun_Repeat');
                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                client.subscribe('/set_Start_hour_value'); client.subscribe('/set_Start_minute_value');
                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                client.subscribe('/set_Repeat_hour_value'); client.subscribe('/set_Repeat_minute_value');

                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                client.subscribe('/Next_hour'); client.subscribe('/Next_minute');
                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                client.subscribe('/WiFi_RSSI');
                client.subscribe('/WiFi_Signal_Quality');
                client.subscribe('/status_version')
                client.subscribe('/status_V')


            });

            client.on('close', () => {
                const st = document.getElementById('status');
                if (st) {
                    st.innerHTML = '<i class="fas fa-unlink" style="color:var(--danger-color); font-size:14px; margin-right:8px;"></i> MQTT: Disconnected';
                    st.style.color = "var(--danger-color)";
                }
            });

            client.on('message', (topic, message) => {
                let msg = message.toString();


                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                if (topic === '/Status_RP_minute') { updateStatusColor('/Status_RP_minute', msg === '1' ? 'Status OPEN' : 'Status CLOSE'); Status_RP_minute = (msg === '1') ? 1 : 0; }
                if (topic === '/Status_RP_minute_hour') { updateStatusColor('/Status_RP_minute_hour', msg === '1' ? 'Status OPEN' : 'Status CLOSE'); Status_RP_minute_hour = (msg === '1') ? 1 : 0; }
                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                const daysOn_Repeat = {
                    '/Mon_Repeat': '/Mon_Repeat',
                    '/Tue_Repeat': '/Tue_Repeat',
                    '/Wed_Repeat': '/Wed_Repeat',
                    '/Thu_Repeat': '/Thu_Repeat',
                    '/Fri_Repeat': '/Fri_Repeat',
                    '/Sat_Repeat': '/Sat_Repeat',
                    '/Sun_Repeat': '/Sun_Repeat',

                };
                if (daysOn_Repeat[topic]) {
                    updateStatusColor(daysOn_Repeat[topic], msg === '1' ? 'ON' : 'Off');
                }

                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                if (topic === '/LED_RP_hour') { updateStatusColor('/LED_RP_hour', msg === '1' ? 'Status OPEN' : 'Status CLOSE'); }
                if (topic === '/LED_RP_minute') { updateStatusColor('/LED_RP_minute', msg === '1' ? 'Status OPEN' : 'Status CLOSE'); }
                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                if (topic === '/status_version') {
                    const tt = document.getElementById('/status_version')
                    if (!tt) return;
                    tt.innerText = "Version : " + msg;
                }

                if (topic === '/status_V') {
                    const tt = document.getElementById('/status_V')
                    if (!tt) return;
                    tt.innerText = msg;
                }


                if (topic === '/WiFi_RSSI') {
                    const tt = document.getElementById('/WiFi_RSSI')
                    if (!tt) return;
                    tt.innerText = msg + " dBm";
                }

                if (topic === '/WiFi_Signal_Quality') {
                    const tt = document.getElementById('/WiFi_Signal_Quality')
                    if (!tt) return;
                    tt.innerText = msg;
                }


                if (topic === '/set_Start_hour_value') {
                    const tt = document.getElementById('/set_Start_hour_value')
                    if (!tt) return;
                    tt.innerText = msg + " H";
                }

                if (topic === '/set_Start_minute_value') {
                    const tt = document.getElementById('/set_Start_minute_value')
                    if (!tt) return;
                    tt.innerText = msg + " M";


                }


                if (topic === '/set_Repeat_hour_value') {
                    const tt = document.getElementById('/set_Repeat_hour_value')
                    if (!tt) return;
                    tt.innerText = msg + " H";
                }

                if (topic === '/set_Repeat_minute_value') {
                    const tt = document.getElementById('/set_Repeat_minute_value')
                    if (!tt) return;
                    tt.innerText = msg + " M";


                }


                if (topic === '/Next_hour') {
                    const tt = document.getElementById('/Next_hour')
                    if (!tt) return;
                    tt.innerText = msg + " H";


                }

                if (topic === '/Next_minute') {
                    const tt = document.getElementById('/Next_minute')
                    if (!tt) return;
                    tt.innerText = msg + " M";


                }

                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



                if (topic === '/node') {
                    const espBadge = document.getElementById('esp_online');
                    if (espBadge) {
                        const isOnline = (msg === '1');

                        if (isOnline) {
                            // ตอนออนไลน์ → ใช้ไอคอนชิปสีเขียว
                            espBadge.innerHTML = '<i class="fas fa-microchip" style="color:var(--success-color); font-size:14px; margin-right:8px;"></i> ESP: Online';
                            espBadge.style.color = "var(--success-color)";
                        } else {
                            // ตอนออฟไลน์ → ใช้วงกลมแดง (เหมือนเดิม)
                            espBadge.innerHTML = '<i class="fas fa-circle" style="color:var(--danger-color); font-size:8px; margin-right:8px;"></i> ESP: Offline';
                            espBadge.style.color = "var(--danger-color)";
                        }
                    }
                }

                if (topic === 'set-p1-ok') { updateStatusColor('setp1', msg === '1' ? 'Status Program 1 ON' : 'Status Program 1 OFF'); a = (msg === '1') ? 1 : 0; }
                if (topic === 'set-p2-ok') { updateStatusColor('setp2', msg === '1' ? 'Status Program 2 ON' : 'Status Program 2 OFF'); p2 = (msg === '1') ? 1 : 0; }
                if (topic === 'set-p3-ok') { updateStatusColor('setp3', msg === '1' ? 'Status Program 3 ON' : 'Status Program 3 OFF'); p3 = (msg === '1') ? 1 : 0; }

                if (topic === '/Status') { updateStatusColor('/Status', msg === '1' ? 'Status Relay ON' : 'Status Relay OFF'); b = (msg === '1') ? 1 : 0; }
                const daysOn = { '/Sun_on': '/Sun', '/Mon_on': '/Mon', '/Tue_on': '/Tue', '/Wed_on': '/Wed', '/Thu_on': '/Thu', '/Fri_on': '/Fri', '/Sat_on': '/Sat' };
                if (daysOn[topic]) updateStatusColor(daysOn[topic], msg === '1' ? 'ON' : 'Off');
                const daysOff = { '/Sun_Status_on': '/Sun_off', '/Mon_Status_on': '/Mon_off', '/Tue_Status_on': '/Tue_off', '/Wed_Status_on': '/Wed_off', '/Thu_Status_on': '/Thu_off', '/Fri_Status_on': '/Fri_off', '/Sat_Status_on': '/Sat_off' };
                if (daysOff[topic]) updateStatusColor(daysOff[topic], msg === '1' ? 'ON' : 'Off');

                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                if (topic === '/Status_set_teMp') { updateStatusColor('/Status_set_teMp', msg === '1' ? 'Status OPEN' : 'Status CLOSE'); Status_set_teMp = (msg === '1') ? 1 : 0; }
                if (topic === '/Status_set_HuMi') { updateStatusColor('/Status_set_HuMi', msg === '1' ? 'Status OPEN' : 'Status CLOSE'); Status_set_HuMi = (msg === '1') ? 1 : 0; }

                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                if (topic === '/Status_set_teMp_Low') { updateStatusColor('/Status_set_teMp_Low', msg === '1' ? 'Status OPEN' : 'Status CLOSE'); Status_set_teMp_Low = (msg === '1') ? 1 : 0; }
                if (topic === '/Status_set_HuMi_Low') { updateStatusColor('/Status_set_HuMi_Low', msg === '1' ? 'Status OPEN' : 'Status CLOSE'); Status_set_HuMi_Low = (msg === '1') ? 1 : 0; }

                if (topic === '/Status_set_teMp_High') { updateStatusColor('/Status_set_teMp_High', msg === '1' ? 'Status OPEN' : 'Status CLOSE'); Status_set_teMp_High = (msg === '1') ? 1 : 0; }
                if (topic === '/Status_set_HuMi_High') { updateStatusColor('/Status_set_HuMi_High', msg === '1' ? 'Status OPEN' : 'Status CLOSE'); Status_set_HuMi_High = (msg === '1') ? 1 : 0; }
                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                if (topic === '/set_temp_high_value') {
                    const tt = document.getElementById('/set_temp_high_value')
                    if (!tt) return;
                    tt.innerText = msg + " °C";
                }
                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                if (topic === '/set_humi_high_value') {
                    const tt = document.getElementById('/set_humi_high_value')
                    if (!tt) return;
                    tt.innerText = msg + " %";
                }
                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                if (topic === '/set_temp_low_value') {
                    const tt = document.getElementById('/set_temp_low_value')
                    if (!tt) return;
                    tt.innerText = msg + " °C";
                }

                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                if (topic === '/set_humi_low_value') {
                    const tt = document.getElementById('/set_humi_low_value')
                    if (!tt) return;
                    tt.innerText = msg + " %";
                }
                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                if (topic === 'tempjee') {
                    const tt = document.getElementById('tempjee');
                    if (!tt) return;

                    tt.innerText = msg + " °C";

                }

                if (topic === 'humijee') {
                    const tt = document.getElementById('humijee');
                    if (!tt) return;

                    tt.innerText = msg + " %";

                }

                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


                const daysOn_p2 = {
                    '/Sun_on_p2': '/Sun_on_p2',
                    '/Mon_on_p2': '/Mon_on_p2',
                    '/Tue_on_p2': '/Tue_on_p2',
                    '/Wed_on_p2': '/Wed_on_p2',
                    '/Thu_on_p2': '/Thu_on_p2',
                    '/Fri_on_p2': '/Fri_on_p2',
                    '/Sat_on_p2': '/Sat_on_p2'
                };


                if (daysOn_p2[topic]) {
                    updateStatusColor(daysOn_p2[topic], msg === '1' ? 'ON' : 'Off');
                }


                const daysOff_p2 = {
                    '/Sun_Status_on_p2': '/Sun_Status_on_p2',
                    '/Mon_Status_on_p2': '/Mon_Status_on_p2',
                    '/Tue_Status_on_p2': '/Tue_Status_on_p2',
                    '/Wed_Status_on_p2': '/Wed_Status_on_p2',
                    '/Thu_Status_on_p2': '/Thu_Status_on_p2',
                    '/Fri_Status_on_p2': '/Fri_Status_on_p2',
                    '/Sat_Status_on_p2': '/Sat_Status_on_p2'
                };


                if (daysOff_p2[topic]) {
                    updateStatusColor(daysOff_p2[topic], msg === '1' ? 'ON' : 'Off');
                }






                const daysOn_p3 = {
                    '/Sun_on_p3': '/Sun_on_p3',
                    '/Mon_on_p3': '/Mon_on_p3',
                    '/Tue_on_p3': '/Tue_on_p3',
                    '/Wed_on_p3': '/Wed_on_p3',
                    '/Thu_on_p3': '/Thu_on_p3',
                    '/Fri_on_p3': '/Fri_on_p3',
                    '/Sat_on_p3': '/Sat_on_p3'
                };

                if (daysOn_p3[topic]) {
                    updateStatusColor(daysOn_p3[topic], msg === '1' ? 'ON' : 'Off');
                }


                const daysOff_p3 = {
                    '/Sun_Status_on_p3': '/Sun_Status_on_p3',
                    '/Mon_Status_on_p3': '/Mon_Status_on_p3',
                    '/Tue_Status_on_p3': '/Tue_Status_on_p3',
                    '/Wed_Status_on_p3': '/Wed_Status_on_p3',
                    '/Thu_Status_on_p3': '/Thu_Status_on_p3',
                    '/Fri_Status_on_p3': '/Fri_Status_on_p3',
                    '/Sat_Status_on_p3': '/Sat_Status_on_p3'
                };

                if (daysOff_p3[topic]) {
                    updateStatusColor(daysOff_p3[topic], msg === '1' ? 'ON' : 'Off');
                }







                if (topic === '/setok') updateStatusColor('/setok', msg === '1' ? 'Time Set ON' : 'Loading');
                if (topic === '/setokk') updateStatusColor('/setokk', msg === '1' ? 'Time Set ON' : 'Loading');
                if (topic === '/setok-time2') updateStatusColor('/setok-time2', msg === '1' ? 'Time Set ON' : 'Loading');
                if (topic === '/setokk-time2') updateStatusColor('/setokk-time2', msg === '1' ? 'Time Set ON' : 'Loading');
                if (topic === '/setok-time3') updateStatusColor('/setok-time3', msg === '1' ? 'Time Set ON' : 'Loading');
                if (topic === '/setokk-time3') updateStatusColor('/setokk-time3', msg === '1' ? 'Time Set ON' : 'Loading');
                if (topic === '/Repeatp1_Status') { updateStatusColor('/Repeatp1_Status', msg === '1' ? 'Set Repeat ON' : 'Set Repeat OFF'); c = (msg === '1') ? 1 : 0; }
                if (topic === '/Repeatp2_Status') { updateStatusColor('/Repeatp2_Status', msg === '1' ? 'Set Repeat ON' : 'Set Repeat OFF'); repeatp2 = (msg === '1') ? 1 : 0; }
                if (topic === '/Repeatp3_Status') { updateStatusColor('/Repeatp3_Status', msg === '1' ? 'Set Repeat ON' : 'Set Repeat OFF'); repeatp3 = (msg === '1') ? 1 : 0; }


                if (topic === '/Sun_on') {
                    Sun = (msg === '1') ? 7 : 0;
                }

                if (topic === '/Mon_on') {
                    Mon = (msg === '1') ? 1 : 0;
                }

                if (topic === '/Tue_on') {
                    Tue = (msg === '1') ? 2 : 0;
                }

                if (topic === '/Wed_on') {
                    Wed = (msg === '1') ? 3 : 0;
                }

                if (topic === '/Thu_on') {
                    Thu = (msg === '1') ? 4 : 0;
                }

                if (topic === '/Fri_on') {
                    Fri = (msg === '1') ? 5 : 0;
                }

                if (topic === '/Sat_on') {
                    Sat = (msg === '1') ? 6 : 0;
                }

                if (topic === '/Sun_Status_on') {
                    Sun_off = (msg === '1') ? 7 : 0;
                }

                if (topic === '/Mon_Status_on') {
                    Mon_off = (msg === '1') ? 1 : 0;
                }

                if (topic === '/Tue_Status_on') {
                    Tue_off = (msg === '1') ? 2 : 0;
                }

                if (topic === '/Wed_Status_on') {
                    Wed_off = (msg === '1') ? 3 : 0;
                }

                if (topic === '/Thu_Status_on') {
                    Thu_off = (msg === '1') ? 4 : 0;
                }

                if (topic === '/Fri_Status_on') {
                    Fri_off = (msg === '1') ? 5 : 0;
                }

                if (topic === '/Sat_Status_on') {
                    Sat_off = (msg === '1') ? 6 : 0;
                }






                if (topic === '/Sun_on_p2') {
                    Sun = (msg === '1') ? 7 : 0;
                }

                if (topic === '/Mon_on_p2') {
                    Mon = (msg === '1') ? 1 : 0;
                }

                if (topic === '/Tue_on_p2') {
                    Tue = (msg === '1') ? 2 : 0;
                }

                if (topic === '/Wed_on_p2') {
                    Wed = (msg === '1') ? 3 : 0;
                }

                if (topic === '/Thu_on_p2') {
                    Thu = (msg === '1') ? 4 : 0;
                }

                if (topic === '/Fri_on_p2') {
                    Fri = (msg === '1') ? 5 : 0;
                }

                if (topic === '/Sat_on_p2') {
                    Sat = (msg === '1') ? 6 : 0;
                }





                if (topic === '/Sun_Status_on_p2') {
                    Sun_off = (msg === '1') ? 7 : 0;
                }

                if (topic === '/Mon_Status_on_p2') {
                    Mon_off = (msg === '1') ? 1 : 0;
                }

                if (topic === '/Tue_Status_on_p2') {
                    Tue_off = (msg === '1') ? 2 : 0;
                }

                if (topic === '/Wed_Status_on_p2') {
                    Wed_off = (msg === '1') ? 3 : 0;
                }

                if (topic === '/Thu_Status_on_p2') {
                    Thu_off = (msg === '1') ? 4 : 0;
                }

                if (topic === '/Fri_Status_on_p2') {
                    Fri_off = (msg === '1') ? 5 : 0;
                }

                if (topic === '/Sat_Status_on_p2') {
                    Sat_off = (msg === '1') ? 6 : 0;
                }




                if (topic === '/Sun_on_p3') {
                    Sun = (msg === '1') ? 7 : 0;
                }

                if (topic === '/Mon_on_p3') {
                    Mon = (msg === '1') ? 1 : 0;
                }

                if (topic === '/Tue_on_p3') {
                    Tue = (msg === '1') ? 2 : 0;
                }

                if (topic === '/Wed_on_p3') {
                    Wed = (msg === '1') ? 3 : 0;
                }

                if (topic === '/Thu_on_p3') {
                    Thu = (msg === '1') ? 4 : 0;
                }

                if (topic === '/Fri_on_p3') {
                    Fri = (msg === '1') ? 5 : 0;
                }

                if (topic === '/Sat_on_p3') {
                    Sat = (msg === '1') ? 6 : 0;




                }





                if (topic === '/Sun_Status_on_p3') {
                    Sun_off = (msg === '1') ? 7 : 0;
                }

                if (topic === '/Mon_Status_on_p3') {
                    Mon_off = (msg === '1') ? 1 : 0;
                }

                if (topic === '/Tue_Status_on_p3') {
                    Tue_off = (msg === '1') ? 2 : 0;
                }

                if (topic === '/Wed_Status_on_p3') {
                    Wed_off = (msg === '1') ? 3 : 0;
                }

                if (topic === '/Thu_Status_on_p3') {
                    Thu_off = (msg === '1') ? 4 : 0;
                }

                if (topic === '/Fri_Status_on_p3') {
                    Fri_off = (msg === '1') ? 5 : 0;
                }

                if (topic === '/Sat_Status_on_p3') {
                    Sat_off = (msg === '1') ? 6 : 0;
                }





            });
        }
        function send_mqtt(topic, mass) { client.publish(topic, mass); }
        var a = null, b = null, c = null, p2 = null, p3 = null, Sun = 0, Mon = 0, Tue = 0, Wed = 0, Thu = 0, Fri = 0, Sat = 0;
        var Sun_off = 0, Mon_off = 0, Tue_off = 0, Wed_off = 0, Thu_off = 0, Fri_off = 0, Sat_off = 0;
        var Status_set_teMp, Status_set_HuMi, Status_set_teMp_Low, Status_set_HuMi_Low, Status_set_teMp_High, Status_set_HuMi_High;
        var Status_RP_minute, Status_RP_minute_hour;

        function send_mqtt_interlock(send_mqtt1, mass1) {
            if (send_mqtt1 === '/pro_Gram-1') {
                if (mass1 === '1' && a === 0) { a = 1; return client.publish(send_mqtt1, mass1, { retain: true }); }
                if (mass1 === '1' && a === 1) { mass1 = '0'; a = 0; return client.publish(send_mqtt1, mass1, { retain: true }); }
            }
            if (send_mqtt1 === '/pro_Gram-2') {
                if (mass1 === '1' && p2 === 0) { p2 = 1; return client.publish(send_mqtt1, mass1, { retain: true }); }
                if (mass1 === '1' && p2 === 1) { mass1 = '0'; p2 = 0; return client.publish(send_mqtt1, mass1, { retain: true }); }
            }
            if (send_mqtt1 === '/pro_Gram-3') {
                if (mass1 === '1' && p3 === 0) { p3 = 1; return client.publish(send_mqtt1, mass1, { retain: true }); }
                if (mass1 === '1' && p3 === 1) { mass1 = '0'; p3 = 0; return client.publish(send_mqtt1, mass1, { retain: true }); }
            }
            if (send_mqtt1 === '/esp_c') {
                if (mass1 === 'ON' && b === 0) { b = 1; return client.publish(send_mqtt1, mass1, { retain: true }); }
                if (b === 1 && mass1 === 'ON') { mass1 = 'OFF'; b = 0; return client.publish(send_mqtt1, mass1, { retain: true }); }
            }
            if (send_mqtt1 === '/Sun') { if (mass1 === '7' && Sun === 0) { Sun = 7; return client.publish(send_mqtt1, mass1, { retain: true }); } if (mass1 === '7' && Sun === 7) { mass1 = '0'; Sun = 0; return client.publish(send_mqtt1, mass1, { retain: true }); } }
            if (send_mqtt1 === '/Mon') { if (mass1 === '1' && Mon === 0) { Mon = 1; return client.publish(send_mqtt1, mass1, { retain: true }); } if (mass1 === '1' && Mon === 1) { mass1 = '0'; Mon = 0; return client.publish(send_mqtt1, mass1, { retain: true }); } }
            if (send_mqtt1 === '/Tue') { if (mass1 === '2' && Tue === 0) { Tue = 2; return client.publish(send_mqtt1, mass1, { retain: true }); } if (mass1 === '2' && Tue === 2) { mass1 = '0'; Tue = 0; return client.publish(send_mqtt1, mass1, { retain: true }); } }
            if (send_mqtt1 === '/Wed') { if (mass1 === '3' && Wed === 0) { Wed = 3; return client.publish(send_mqtt1, mass1, { retain: true }); } if (mass1 === '3' && Wed === 3) { mass1 = '0'; Wed = 0; return client.publish(send_mqtt1, mass1, { retain: true }); } }
            if (send_mqtt1 === '/Thu') { if (mass1 === '4' && Thu === 0) { Thu = 4; return client.publish(send_mqtt1, mass1, { retain: true }); } if (mass1 === '4' && Thu === 4) { mass1 = '0'; Thu = 0; return client.publish(send_mqtt1, mass1, { retain: true }); } }
            if (send_mqtt1 === '/Fri') { if (mass1 === '5' && Fri === 0) { Fri = 5; return client.publish(send_mqtt1, mass1, { retain: true }); } if (mass1 === '5' && Fri === 5) { mass1 = '0'; Fri = 0; return client.publish(send_mqtt1, mass1, { retain: true }); } }
            if (send_mqtt1 === '/Sat') { if (mass1 === '6' && Sat === 0) { Sat = 6; return client.publish(send_mqtt1, mass1, { retain: true }); } if (mass1 === '6' && Sat === 6) { mass1 = '0'; Sat = 0; return client.publish(send_mqtt1, mass1, { retain: true }); } }
            if (send_mqtt1 === '/Sun_Set_off') { if (mass1 === '7' && Sun_off === 0) { Sun_off = 7; return client.publish(send_mqtt1, mass1, { retain: true }); } if (mass1 === '7' && Sun_off === 7) { mass1 = '0'; Sun_off = 0; return client.publish(send_mqtt1, mass1, { retain: true }); } }
            if (send_mqtt1 === '/Mon_Set_off') { if (mass1 === '1' && Mon_off === 0) { Mon_off = 1; return client.publish(send_mqtt1, mass1, { retain: true }); } if (mass1 === '1' && Mon_off === 1) { mass1 = '0'; Mon_off = 0; return client.publish(send_mqtt1, mass1, { retain: true }); } }
            if (send_mqtt1 === '/Tue_Set_off') { if (mass1 === '2' && Tue_off === 0) { Tue_off = 2; return client.publish(send_mqtt1, mass1, { retain: true }); } if (mass1 === '2' && Tue_off === 2) { mass1 = '0'; Tue_off = 0; return client.publish(send_mqtt1, mass1, { retain: true }); } }
            if (send_mqtt1 === '/Wed_Set_off') { if (mass1 === '3' && Wed_off === 0) { Wed_off = 3; return client.publish(send_mqtt1, mass1, { retain: true }); } if (mass1 === '3' && Wed_off === 3) { mass1 = '0'; Wed_off = 0; return client.publish(send_mqtt1, mass1, { retain: true }); } }
            if (send_mqtt1 === '/Thu_Set_off') { if (mass1 === '4' && Thu_off === 0) { Thu_off = 4; return client.publish(send_mqtt1, mass1, { retain: true }); } if (mass1 === '4' && Thu_off === 4) { mass1 = '0'; Thu_off = 0; return client.publish(send_mqtt1, mass1, { retain: true }); } }
            if (send_mqtt1 === '/Fri_Set_off') { if (mass1 === '5' && Fri_off === 0) { Fri_off = 5; return client.publish(send_mqtt1, mass1, { retain: true }); } if (mass1 === '5' && Fri_off === 5) { mass1 = '0'; Fri_off = 0; return client.publish(send_mqtt1, mass1, { retain: true }); } }
            if (send_mqtt1 === '/Sat_Set_off') { if (mass1 === '6' && Sat_off === 0) { Sat_off = 6; return client.publish(send_mqtt1, mass1, { retain: true }); } if (mass1 === '6' && Sat_off === 6) { mass1 = '0'; Sat_off = 0; return client.publish(send_mqtt1, mass1, { retain: true }); } }

            if (send_mqtt1 === '/Repeatp1') {
                if (mass1 === '1' && c === 0) { c = 1; return client.publish(send_mqtt1, mass1, { retain: true }); }
                if (mass1 === '1' && c === 1) { mass1 = '0'; c = 0; return client.publish(send_mqtt1, mass1, { retain: true }); }
            }
            if (send_mqtt1 === '/Repeatp2') {
                if (mass1 === '1' && repeatp2 === 0) { repeatp2 = 1; return client.publish(send_mqtt1, mass1, { retain: true }); }
                if (mass1 === '1' && repeatp2 === 1) { mass1 = '0'; repeatp2 = 0; return client.publish(send_mqtt1, mass1, { retain: true }); }
            }
            if (send_mqtt1 === '/Repeatp3') {
                if (mass1 === '1' && repeatp3 === 0) { repeatp3 = 1; return client.publish(send_mqtt1, mass1, { retain: true }); }
                if (mass1 === '1' && repeatp3 === 1) { mass1 = '0'; repeatp3 = 0; return client.publish(send_mqtt1, mass1, { retain: true }); }
            }

            if (send_mqtt1 === 'set_teMP') {
                if (mass1 === '1' && Status_set_teMp === 0) {

                    Status_set_teMp = 1;
                    return client.publish(send_mqtt1, mass1, { retain: true });

                }

                if (mass1 === '1' && Status_set_teMp === 1) {

                    mass1 = '0';
                    Status_set_teMp = 0;
                    return client.publish(send_mqtt1, mass1, { retain: true });

                }

            }


            if (send_mqtt1 === 'set_HuMi') {
                if (mass1 === '1' && Status_set_HuMi === 0) {
                    Status_set_HuMi = 1;
                    return client.publish(send_mqtt1, mass1, { retain: true })

                }

                if (mass1 === '1' && Status_set_HuMi === 1) {
                    mass1 = '0';
                    Status_set_HuMi = 0;
                    return client.publish(send_mqtt1, mass1, { retain: true })

                }

            }

            if (send_mqtt1 === 'set_HuMi') {
                if (mass1 === '1' && Status_set_HuMi === 0) {
                    Status_set_HuMi = 1;
                    return client.publish(send_mqtt1, mass1, { retain: true })

                }

                if (mass1 === '1' && Status_set_HuMi === 1) {
                    mass1 === '0';
                    Status_set_HuMi = 0;
                    return client.publish(send_mqtt1, mass1, { retain: true })

                }

            }

            if (send_mqtt1 === 'set_teMP_Low') {
                if (mass1 === '1' && Status_set_teMp_Low === 0) {
                    Status_set_teMp_Low = 1;
                    return client.publish(send_mqtt1, mass1, { retain: true })

                }

                if (mass1 === '1' && Status_set_teMp_Low === 1) {
                    mass1 = '0';
                    Status_set_teMp_Low = 0;
                    return client.publish(send_mqtt1, mass1, { retain: true })

                }

            }



            if (send_mqtt1 === 'set_HuMi_Low') {
                if (mass1 === '1' && Status_set_HuMi_Low === 0) {
                    Status_set_HuMi_Low = 1;
                    return client.publish(send_mqtt1, mass1, { retain: true })

                }

                if (mass1 === '1' && Status_set_HuMi_Low === 1) {
                    mass1 = '0';
                    Status_set_HuMi_Low = 0;
                    return client.publish(send_mqtt1, mass1, { retain: true })

                }

            }

            if (send_mqtt1 === 'set_teMP_High') {
                if (mass1 === '1' && Status_set_teMp_High === 0) {
                    Status_set_teMp_High = 1;
                    return client.publish(send_mqtt1, mass1, { retain: true })

                }

                if (mass1 === '1' && Status_set_teMp_High === 1) {
                    mass1 = '0';
                    Status_set_teMp_High = 0;
                    return client.publish(send_mqtt1, mass1, { retain: true })

                }

            }

            if (send_mqtt1 === 'set_HuMi_High') {
                if (mass1 === '1' && Status_set_HuMi_High === 0) {
                    Status_set_HuMi_High = 1;
                    return client.publish(send_mqtt1, mass1, { retain: true })

                }

                if (mass1 === '1' && Status_set_HuMi_High === 1) {
                    mass1 = '0';
                    Status_set_HuMi_High = 0;
                    return client.publish(send_mqtt1, mass1, { retain: true })

                }

            }


            if (send_mqtt1 === '/Repeat_minute') {
                if (mass1 === '1' && Status_RP_minute === 0) {
                    Status_RP_minute = 1;
                    return client.publish(send_mqtt1, mass1, { retain: true })

                }

                if (mass1 === '1' && Status_RP_minute === 1) {
                    mass1 = '0';
                    Status_RP_minute = 0;
                    return client.publish(send_mqtt1, mass1, { retain: true })

                }

            }

            if (send_mqtt1 === '/Repeat_minute_hour') {
                if (mass1 === '1' && Status_RP_minute_hour === 0) {
                    Status_RP_minute_hour = 1;
                    return client.publish(send_mqtt1, mass1, { retain: true })

                }

                if (mass1 === '1' && Status_RP_minute_hour === 1) {
                    mass1 = '0';
                    Status_RP_minute_hour = 0;
                    return client.publish(send_mqtt1, mass1, { retain: true })

                }



            }



        }
    </script>
</head>

<body>
    <div class="dev-badge">DEVELOPMENT MODE</div>

    <div class="header-status">
        <div class="status-badge" id="status" style="color:var(--text-muted)">
            <i class="fas fa-circle-notch fa-spin"></i> MQTT: Checking
        </div>
        <div class="status-badge" id="esp_online" style="color:var(--text-muted)">
            <i class="fas fa-microchip"></i> ESP: Checking
        </div>
    </div>

    <nav class="main-nav">
        <button class="btn-nav" onclick="go('home')">
            <i class="fas fa-home"></i> <span>หน้าหลัก</span>
        </button>
        <button class="btn-nav" onclick="logout()" style="color:var(--danger-color)">
            <i class="fas fa-sign-out-alt"></i> <span>ออกระบบ</span>
        </button>
    </nav>


    <!-- WiFi Status - เพิ่มระยะห่างให้ดูโปร่งขึ้น -->
    <div class="header-status" style="margin: 1px 0 32px 0; gap: 16px;">
        <div class="status-badge" id="wifi-rssi-badge" style="padding: 16px 20px; font-size: 14px;">
            <i class="fas fa-signal" style="margin-right: 10px; font-size: 16px;"></i>
            WiFi RSSI: <span id="/WiFi_RSSI">-- dBm</span>
        </div>

        <div class="status-badge" id="wifi-quality-badge" style="padding: 16px 20px; font-size: 14px;">
            <i class="fas fa-wifi" style="margin-right: 10px; font-size: 16px;"></i>
            WiFi สถานะ: <span id="/WiFi_Signal_Quality">--</span>
        </div>
    </div>

    <div id="app"></div>

</body>

</html>
